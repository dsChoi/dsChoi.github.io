# 우아한 모노리스

2020-01-23

https://github.com/arawn/building-modular-monoliths-using-spring



https://www.slideshare.net/arawnkr/ss-195979955

- 박용권



* 모노리스에서 마이크로 서비스로 넘어가는 법

* 마이크로서비스 -> 모노리스로 변경



## 우린 마이크로서비스에서 모노리틱으로 갈아탔다.

1. 혼잡한 기능 수행
2. 공유된 데이터 원본
3. 동시배포





마이크로에서 모노리틱으로?

시스템 조직 운영 관점에서..



공유된 데이터 원본

### 하나의 테이블을 여러 서비스가 사용하는 경우

중복된 코드가 여러개 나올수 있음.

중복된 코드로 인해서 혼잡한 기능 수행을 함.

코드 플로우만 따라가서는 알수가 없음.

기능 파악이 어려우면 빠른 서비스 반영이 어려워진다.

- 개발 기간 및 테스트기간이 늘어난다.



동시배포 문제 

한팀에서 한다면 문제가 없지만 다른 팀의 소유인데 같은 시간에 배포할수가 없음.



## 우리에겐 그림자 분신술이 필요했다.

여러 마이크로서비스 를 소수의 개발자가 담당.



일정의 압박과 함께 비지니스 요구!

그럼 빨리 동작하게 집중함. 



## 우린 마이크로서비스에서 모노리틱으로 갈아탐.

합치고 필요하면 다시 나누자.



##모노티리틱으로 되돌아가는 여정

1. 프로젝트별 구조 정리

2. 저장소 및 프로젝트 통합
   1. 파일 새로 만들기
   2. 깃 저장소 머지 
      1. 과거 히스토리를 남기려고..
      2. 그래들 의존성 확인 및 정리
3. 패키지 구조 표준화



여러개의 컨텍스트를 계층구조형식으로 

```



```





## 모노리틱은 나쁘고, 마이크로서비스는 좋다?

모노리틱 vs 마이크로서비스



배달의 민족 

모노리틱 -> 마이크로서비스로 정상적으로 변경



그러나 모든 서비스가 마이크로 서비스여야하나..?  그건 아니다.

## 모노리틱이 가진 주요 단점과 한계

### 단점

1. 예상치 못한 결합
2. 높은 테스트 비용
3. 늦은 출시 싸이클



### 한계

1. 부족한 장애 내성
   1. 한군데 에러면 모든 에러 발생
2. 단일 확장성
   1. 수평확장만 가능



## 마이크로서비스가 주는 주요 혜택 살펴보기

### 혜택

1. 조직 부합성
2. 확장성
3. 회복성
4. 배포 용이성
5. 조합성
6. 대체 가능성
7. 기술 이기종성

## 마이크로서비스는 자율적이다?

원칙에 따라서 변하고 책임진다.? 



## 아키텍처 스타일을 변경하면 문제가 해결된다?



큰 진흙덩어리형 모노리스 -> 마이크로서비스 ( 우리가 원하는 미래 )



분산된 모노리스가 발생할수 있다.



## 응집과 결합을 다스리는 것이 먼저다.



높은 응집도 낮은 결합도



Dan North



소프트웨어 개발의 목적은 긍정적인 비지니스 , 가능한한 빠르게 

The goal of software delivery is to minimize the lead time to business impact, Everything else is detail.

지속적인 반영, 변경 반영

새로운 비지니스는 변화에 따라야한다.



### 적은 비용으로 변경할수 있는 구조 만들기.

변화의 성격과 두려움. 켄트 벡



응집 

- 시스템의 변경이 필요할때 하나의 요소에서 변화하는 정도
- 같은 패키지



결합

* 다른 패키지에 영향이 있다..
* 결합도가 낮은 것을 원함.



서비스를 잘게 쪼개면 하나의 변화가 다른곳에 영향을 끼칠수있다.

결합도가 높음

한곳에 모으면..? 응집도가 낮아짐. 

밸런스 유지를 잘해야한다.



## 주어진 상황에 따라 적절한 도구를 선택하자.

모노리스

단일 프로젝트에 모든 코드가 모여있다.

시스템 구조가 간결하고, 빠르게 구축할수 있다.





마이크로

시스템을 조직 구조에 맞게 정렬

서비스를 독립적으로 배포 또는 확장 할 수 있다.

서비스 장애가 시스템 전체 장애로 전파되지 않는다.

문제 해결에 특화된 다양한 기술을 추가할수 있다.





## 변경을 수용할 수 있는 소프트웨어 아키텍처

헥사고날 아키텍처 - 포트



의존 방향 -> 인프라스트럭처 영역(외부) -> 도메인 영역(내부)





## 관심에 따른 모듈화



수직적 관심사



수평적 관심사



**시스템을 만들기 위한 모듈들**

비지니스와 응용 프로그램에 특화된 기능

**로깅, 트랜잭션**

재사용성, 범용적이어야함.



## 의존성 관리로 느슨하게 결합된 모듈 설계하기



화살표는 한쪽으로만 ..

원형 의존성은 .. 빼야함. 



ShippingDesk 





바운디드 컨텍스트 맵핑



DDD 





github.com/odrotbohm/moduliths



변경을 빨리 수용



모듈 인터페이스

서비스 인터페이스 



어플리케이션에서 각 



반 부패계층

시스템 시스템





